EnvironmentConfigurationMetadata:
  DateModified: '1552330123689'
Outputs:
  AWSEBRDSDatabaseProperties:
    Description: Properties associated with the RDS database instance
    Value:
      Fn::Join:
      - ','
      - - Ref: AWSEBRDSDatabase
        - Fn::GetAtt:
          - AWSEBRDSDatabase
          - Endpoint.Address
        - Fn::GetAtt:
          - AWSEBRDSDatabase
          - Endpoint.Port
Parameters:
  AWSEBDBName:
    ConstraintDescription: must contain only alphanumeric characters
    Default: ebdb
    Description: The DB Name of the RDS instance
    NoEcho: 'true'
    Type: String
  AWSEBDBPassword:
    ConstraintDescription: must contain only alphanumeric characters
    Description: The master password for the DB instance.
    NoEcho: 'true'
    Type: String
  AWSEBDBUser:
    ConstraintDescription: must begin with a letter and contain only alphanumeric
      characters
    Default: ebroot
    Description: The name of master user for the client DB Instance.
    NoEcho: 'true'
    Type: String
Resources:
  AWSEBAutoScalingGroup:
    Metadata:
      AWS::ElasticBeanstalk::Ext:
        _ContainerConfigFileContent:
          plugins:
            rds:
              Description: RDS Environment variables
              env:
                RDS_DB_NAME:
                  Ref:
                    CmpFn::Ref: Parameter.AWSEBDBName
                RDS_HOSTNAME:
                  Fn::GetAtt:
                  - AWSEBRDSDatabase
                  - Endpoint.Address
                RDS_PASSWORD:
                  Ref:
                    CmpFn::Ref: Parameter.AWSEBDBPassword
                RDS_PORT:
                  Fn::GetAtt:
                  - AWSEBRDSDatabase
                  - Endpoint.Port
                RDS_USERNAME:
                  Ref:
                    CmpFn::Ref: Parameter.AWSEBDBUser
        _ParameterTriggers:
          _TriggerConfigDeployment:
            CmpFn::Insert:
              values:
              - CmpFn::Ref: Parameter.AWSEBDBUser
              - CmpFn::Ref: Parameter.AWSEBDBPassword
              - CmpFn::Ref: Parameter.AWSEBDBName
  AWSEBRDSDBSecurityGroup:
    Properties:
      GroupDescription: Enable database access to Beanstalk application
      SecurityGroupIngress:
        FromPort: '0'
        IpProtocol: tcp
        SourceSecurityGroupId:
          Fn::GetAtt:
          - AWSEBSecurityGroup
          - GroupId
        ToPort: '65535'
    Type: AWS::EC2::SecurityGroup
  AWSEBRDSDatabase:
    DeletionPolicy: Delete
    Properties:
      AllocatedStorage: '5'
      DBInstanceClass: db.t2.micro
      DBName:
        Ref:
          CmpFn::Ref: Parameter.AWSEBDBName
      Engine: mysql
      EngineVersion: '5.6'
      MasterUserPassword:
        Ref:
          CmpFn::Ref: Parameter.AWSEBDBPassword
      MasterUsername:
        Ref:
          CmpFn::Ref: Parameter.AWSEBDBUser
      MultiAZ: false
      VPCSecurityGroups:
      - Fn::GetAtt:
        - AWSEBRDSDBSecurityGroup
        - GroupId
    Type: AWS::RDS::DBInstance
SnippetMetadata:
  Description: RDS Snippet
  Documentation: RDS Snippet for AWS ElasticBeanStalk
  Version: '1.0'
